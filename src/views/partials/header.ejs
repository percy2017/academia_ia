<header class="navbar sticky-top bg-dark flex-md-nowrap p-0 shadow" data-bs-theme="dark">
  <a class="navbar-brand px-3 text-white" href="/"> <i class="bi bi-mortarboard-fill" style="font-size: 2rem;"></i> Academia AI v1.0</a>
  
  <button class="navbar-toggler d-md-none collapsed" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebarOffcanvas" aria-controls="sidebarOffcanvas" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  
  <!-- El input de búsqueda y el enlace de cerrar sesión han sido removidos de aquí para hacer la barra más delgada -->
  <!-- Se puede considerar agregar un icono de búsqueda que active un modal o un campo en otro lugar -->
  <style>
    .user-dropdown { /* Contenedor del dropdown */
      position: relative; 
    }
    .user-dropdown .dropdown-menu {
      position: absolute !important; /* Forzar posicionamiento absoluto */
      top: 100%; /* Posicionar justo debajo del activador */
      right: 0; /* Alineado a la derecha del contenedor relativo */
      left: auto; /* Evitar que se extienda a la izquierda */
      z-index: 1050; /* Asegurar que esté por encima de otros elementos */
      float: none; /* Bootstrap a veces usa float, esto lo anula si es necesario */
    }
  </style>
  <% if (locals.user) { %>
  <div class="navbar-nav ms-auto me-3"> <!-- ms-auto para empujar a la derecha, me-3 para margen -->
    <div class="nav-item dropdown user-dropdown">
      <a href="#" class="nav-link dropdown-toggle d-flex align-items-center text-white" id="userDropdownMenuLink" role="button" data-bs-toggle="dropdown" aria-expanded="false">
        <% if (locals.user.avatarUrl) { %>
          <img src="<%= locals.user.avatarUrl %>" alt="Avatar" width="32" height="32" class="rounded-circle me-2" style="object-fit: cover;">
        <% } else { %>
          <!-- Placeholder si no hay avatar, usando Bootstrap Icons -->
          <i class="bi bi-person-circle fs-4 me-2"></i>
        <% } %>
        <%= locals.user.name || locals.user.email %>
      </a>
      <ul class="dropdown-menu dropdown-menu-dark dropdown-menu-end" aria-labelledby="userDropdownMenuLink">
        <li><a class="dropdown-item" href="/profile">
          <i class="bi bi-person-fill me-2"></i>Mi Perfil
        </a></li>
        <li><a class="dropdown-item" href="/profile/edit">
          <i class="bi bi-pencil-square me-2"></i>Editar Perfil
        </a></li>
        <li><hr class="dropdown-divider"></li>
        <li><a class="dropdown-item" href="/auth/logout">
          <i class="bi bi-box-arrow-right me-2"></i>Cerrar Sesión
        </a></li>
      </ul>
    </div>
  </div>
  <% } else { %>
    <!-- Opcional: Mostrar enlace de Login/Register si el usuario no está autenticado -->
    <!-- 
    <div class="navbar-nav ms-auto me-3">
      <a href="/auth/login" class="nav-link text-white">Iniciar Sesión</a>
    </div> 
    -->
  <% } %>
</header>
